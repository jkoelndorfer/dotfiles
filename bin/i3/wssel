#!/bin/bash

prompt="${1:-workspace}"
workspaces="$("$DOTFILE_DIR/bin/i3/workspaces")"

# There is some sort of bug in Rofi when displaying multiple fonts.
# Without -no-show-match, space characters appear as blocks.
# Very strange!
selected_workspace="$(
    echo "$workspaces" |
    "$DOTFILE_DIR/bin/rofi" -no-show-match -dmenu -p "$prompt" |
    # If the workspace selected starts with a character and a space,
    # it's one of the built-in workspaces or already exists. We need
    # to strip the leading icon off before passing the workspace to awk.
    sed -r -e 's/^. //' |
    awk -F "$(echo -e "\t")" '{ print $NF }' |
    sed -r -e 's/\s+/-/g'
)"

if [[ -z "$selected_workspace" ]]; then
    exit 1
fi
echo "$selected_workspace"
