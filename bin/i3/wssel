#!/bin/bash

prompt="${1:-workspace}"
workspaces="$("$DOTFILE_DIR/bin/i3/workspaces")"

if [[ -n "$WAYLAND_DISPLAY" ]]; then
    selector=("$DOTFILE_DIR/bin/wrappers/wofi" --show=dmenu --prompt "$prompt")
elif [[ -n "$DISPLAY" ]]; then
    # There is some sort of bug in Rofi when displaying multiple fonts.
    # Without -no-show-match, space characters appear as blocks.
    # Very strange!
    selector=("$DOTFILE_DIR/bin/wrappers/rofi" -no-show-match -dmenu -p "$prompt")
else
    echo "$0: Neither WAYLAND_DISPLAY nor DISPLAY are set" >&2
    exit 1
fi
selected_workspace="$(
    echo "$workspaces" |
    "${selector[@]}" |
    # If the workspace selected starts with an icon and an output
    # indicator, it's one of the built-in workspaces or already exists.
    # We need to strip the leading bits off.
    sed -r -e 's/^. . //' |
    sed -r -e 's/(\s+|\.|\*)/-/g'
)"

if [[ -z "$selected_workspace" ]]; then
    exit 1
fi
echo "$selected_workspace"
