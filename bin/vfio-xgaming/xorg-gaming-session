#!/bin/bash

function cleanup() {
    rm -f "$i3_tmp_config"
}

script_dir=$(dirname "$0")
"$DOTFILE_DIR/bin/mouseaccel" off

i3_tmp_config=$(mktemp --tmpdir 'i3.config.XXXXXX')
trap cleanup EXIT
grep -v 'PRIMARYONLY' "$DOTFILE_DIR/i3/config" > "$i3_tmp_config"
export XORG_GAMING_SESSION='1'

"$script_dir/xorg-device-state" disable "$X11_MOUSE_DEVICE"
"$script_dir/xorg-device-state" disable "$X11_KEYBOARD_DEVICE"
i3 --config "$i3_tmp_config" &
i3_pid="$!"
synergyc --name "$SYNERGY_GAMING_SCREEN" --debug DEBUG --log /dev/stderr --no-daemon 127.0.0.1 &
synergyc_pid="$!"
wait "$i3_pid"
kill "$synergyc_pid"
