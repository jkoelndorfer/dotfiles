#!/bin/bash

script_dir=$(dirname "$0")
cd "$script_dir"

mode=$1

function sg() {
    local geometry
    if [[ -n "$WAYLAND_DISPLAY" ]]; then
        if [[ "$mode" == 'capture-region' ]]; then
            geometry=$(slurp -d)
            if [[ -z "$geometry" ]]; then
                exit 1
            fi
        else
            geometry="0,0 $(./screen-resolution)"
        fi
        grim -t png -g "$geometry" /dev/stdout
    elif [[ -n "$DISPLAY" ]]; then
        if [[ "$mode" == 'capture-region' ]]; then
            maim_args=(-s)
        else
            maim_args=()
        fi
        maim --hidecursor -f 'png' "${maim_args[@]}"
    else
        echo "$0: neither WAYLAND_DISPLAY nor DISPLAY are set" >&2
        exit 2
    fi
}

if [[ "$mode" != 'capture-region' && "$mode" != 'capture-full-screen' ]]; then
    echo "$0: unrecognized mode '$mode'"
    exit 1
fi
sg | ./copy-to-clipboard 'image/png'
