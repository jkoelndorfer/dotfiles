#!/bin/zsh

source "$DOTFILE_DIR/colors/solarized-dark"
declare -a wallpaper_args
if [[ -n "$WALLPAPER_BLURRED" ]]; then
    wallpaper_args=('-i' "$WALLPAPER_BLURRED")
else
    wallpaper_args=()
fi

spotifyctl=(playerctl -p spotify)
original_spotify_status=$($spotifyctl status)
# Sending SIGUSR1 to dunst will prevent it from displaying notifications.
# SIGUSR2 resumes notifications again.
#
# Suspending notifications is handy when the screen is locked!
pkill -SIGUSR1 dunst

# NOTE: Redirecting the output of this subshell to /dev/null is
# required so that it actually works. I have no idea why.
{
    xset +dpms
    sleep 30

    if pgrep -s 0 i3lock; then
        xset dpms force off
    fi
} > /dev/null 2>&1 &

if [[ "$original_spotify_status" == 'Playing' ]]; then
    $spotifyctl pause
fi
i3lock -n "${wallpaper_args[@]}" -c "$(echo "$SOLARIZED_BASE03" | sed -e 's/^#//')"
if [[ "$original_spotify_status" == 'Playing' ]]; then
    $spotifyctl play
fi
pkill -SIGUSR2 dunst
